<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.infosmart.mapper.DwpasUserCounselMapper">
	<!-- 指标信息记录集 -->
	<resultMap id="java.util.HashMap" type="DwpasCKpiInfo">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Feb 20 17:20:52 
			CST 2012. -->
		<result column="kpi_code" property="kpiCode" jdbcType="VARCHAR" />
		<result column="parent_code" property="parentCode" jdbcType="VARCHAR" />
		<result column="kpi_name" property="kpiName" jdbcType="VARCHAR" />
		<result column="disp_name" property="dispName" jdbcType="VARCHAR" />
		<result column="kpi_type" property="kpiType" jdbcType="CHAR" />
		<result column="is_overall" property="isOverall" jdbcType="CHAR" />
		<result column="is_show" property="isShow" jdbcType="CHAR" />
		<result column="show_order" property="showOrder" jdbcType="DECIMAL" />
		<result column="is_average" property="isAverage" jdbcType="CHAR" />
		<result column="is_max" property="isMax" jdbcType="CHAR" />
		<result column="is_variation" property="isVariation" jdbcType="CHAR" />
		<result column="is_percent" property="isPercent" jdbcType="CHAR" />
		<result column="unit" property="unit" jdbcType="VARCHAR" />
		<result column="decimal_num" property="decimalNum" jdbcType="DECIMAL" />
		<result column="convert_num" property="convertNum" jdbcType="DECIMAL" />
		<result column="convert_type" property="convertType" jdbcType="CHAR" />
		<result column="is_cal_kpi" property="isCalKpi" jdbcType="CHAR" />
		<result column="role_formula" property="roleFormula" jdbcType="VARCHAR" />
		<result column="is_use" property="isUse" jdbcType="CHAR" />
		<result column="GMT_CREATE" property="gmtCreate" jdbcType="TIMESTAMP"
			javaType="java.util.Date" />
		<!-- 数据为 0000-00-00 00:00:00 会报错，暂时去掉 -->
		<!-- <result column="GMT_MODIFIED" property="gmtModified" jdbcType="TIMESTAMP" 
			javaType="java.util.Date" /> -->
	</resultMap>	
<!-- 	<resultMap id="java.util.HashMap" type="DwpasCPrdInfo"> -->
<!-- 		<id property="productId" column="PRODUCT_ID" jdbcType="VARCHAR" /> -->
<!-- 		<result property="parentId" column="PARENT_ID" jdbcType="VARCHAR" /> -->
<!-- 		<result property="isFolder" column="IS_FOLDER" jdbcType="CHAR" /> -->
<!-- 		<result property="productName" column="PRODUCT_NAME" jdbcType="VARCHAR" /> -->
<!-- 		<result property="productMark" column="PRODUCT_MARK" jdbcType="CHAR" /> -->
<!-- 		<result property="isIndexShow" column="IS_INDEX_SHOW" jdbcType="CHAR" /> -->
<!-- 		<result property="indexShowOrder" column="INDEX_SHOW_ORDER" -->
<!-- 			jdbcType="DECIMAL" /> -->
<!-- 		<result property="isUse" column="IS_USE" jdbcType="CHAR" /> -->
<!-- 		<result property="iconUrl" column="ICON_URL" jdbcType="VARCHAR" /> -->
<!-- 		<result property="funnelId" column="FUNNEL_ID" jdbcType="VARCHAR" /> -->
<!-- 		<result property="funnelName" column="FUNNEL_NAME" jdbcType="VARCHAR" /> -->
<!-- 		<result property="gmtCreate" column="GMT_CREATE" jdbcType="TIMESTAMP" /> -->
		<!-- 暂时有问题 -->
		<!-- <result property="gmtModified" column="GMT_MODIFIED" javaType="java.util.Date" 
			jdbcType="TIMESTAMP" /> -->
<!-- 	</resultMap> -->
	<!-- zy三表关联 -->
	<select id="qryAllByComAndPrdIds" resultType="java.util.HashMap" parameterType="java.util.HashMap">
		
		select
		ki.kpi_code, pk.product_id, ki.parent_code, ki.kpi_name,
		ki.disp_name,
		ki.kpi_type, ki.is_overall, ki.is_show, ki.show_order,
		ki.is_average,
		ki.is_max, ki.is_variation, ki.is_percent, ki.unit,
		ki.decimal_num,
		ki.convert_num, ki.convert_type,
		ki.is_cal_kpi,
		ki.role_formula, ki.is_use, ki.gmt_create, ki.gmt_modified
		from
		dwpas_c_kpi_info ki, dwpas_r_kpi_comkpi kc, dwpas_r_prd_kpi pk
		where
		kc.com_kpi_code=#{comKpiCode,jdbcType=VARCHAR}
		and
		ki.kpi_type=#{kpiType,jdbcType=VARCHAR} and ki.is_use='1'
		and
		pk.product_id in
		<foreach collection="productIds" item="productId" open="("
			close=")" separator=",">
			#{productId,jdbcType=VARCHAR}
		</foreach>
		and ki.kpi_code=kc.kpi_code
		and ki.kpi_code=pk.kpi_code
		order by
		ki.show_order asc
	</select>
</mapper>