<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.infosmart.mapper.DwpasCColumnInfoSqlMap">
    <!-- 默认加上缓存 -->
    <!--
    <cache readOnly="true"/>
    -->
	<!-- 栏目管理 -->
	<resultMap id="DwpasCColumnInfoResultMap" type="DwpasCColumnInfo">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Fri Mar 02 09:56:01 
			CST 2012. -->
		<result column="COLUMN_ID" property="columnId" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="COLUMN_CODE" property="columnCode" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="COLUMN_NAME" property="columnName" jdbcType="VARCHAR"
			javaType="string" />
		<result column="COUMN_DISPLAY_NAME" property="columnDisplayName"
			jdbcType="VARCHAR" javaType="string" />
		<result column="COLUMN_KIND" property="columnKind" jdbcType="VARCHAR"
			javaType="string" />
		<result property="columnOrder" column="COLUMN_ORDER" javaType="int"
			jdbcType="INTEGER" />
		<result column="IS_SHOW" property="isShow" jdbcType="INTEGER"
			javaType="int" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="GMT_CREATE" property="gmtCreate" jdbcType="TIMESTAMP"
			javaType="java.util.Date" />
		<!-- 新增 -->
		<!-- 图的类型 -->
		<result property="chartType" column="CHART_TYPE" javaType="int"
			jdbcType="INTEGER" />
		<result property="chartTypeDesc" column="CHART_TYPE_DESC"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<!-- 图的URL -->
		<result property="columnUrl" column="CHART_URL" javaType="java.lang.String"
			jdbcType="VARCHAR" />
	</resultMap>
	<!-- 栏目关联的通用指标集合 -->
	<resultMap id="DwpasRColumnComKpiMap" type="DwpasRColumnComKpi">
		<result property="columnId" column="COLUMN_ID" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="columnCode" column="COLUMN_CODE" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="columnName" column="COLUMN_NAME" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="comKpiCode" column="com_kpi_code" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="comKpiName" column="com_kpi_name" javaType="java.lang.String"
			jdbcType="VARCHAR" />
	</resultMap>
	<!-- 模块信息 -->
	<resultMap id="DwpasCModuleInfoMap" type="DwpasCModuleInfo">
		<result column="MODULE_ID" property="moduleId" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="MENU_ID" property="menuId" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result property="moduleCode" column="MODULE_CODE" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="MODULE_NAME" property="moduleName" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="DATE_TYPE" property="dateType" jdbcType="VARCHAR"
			javaType="java.lang.String" />
		<result column="IS_SHOW" property="isShow" jdbcType="INTEGER"
			javaType="int" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR"
			javaType="java.lang.String" />
	</resultMap>
	<!-- 栏目及模块信息 -->
	<resultMap id="ColumnAndModuleResultMap" type="DwpasCColumnInfo">
		<result column="COLUMN_ID" property="columnId" jdbcType="INTEGER"
			javaType="string" />
		<result column="COLUMN_CODE" property="columnCode" jdbcType="VARCHAR"
			javaType="string" />
		<result column="COLUMN_NAME" property="columnName" jdbcType="VARCHAR"
			javaType="string" />
		<result property="columnOrder" column="COLUMN_ORDER" javaType="int"
			jdbcType="INTEGER" />
		<result column="IS_SHOW" property="isShow" jdbcType="INTEGER"
			javaType="int" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR"
			javaType="string" />
		<result column="GMT_CREATE" property="gmtCreate" jdbcType="TIMESTAMP"
			javaType="java.util.Date" />
		<!-- 一对一,关联模块信息 -->
		<association property="moduleInfo" column="MODULE_ID"
			resultMap="DwpasCModuleInfoMap"></association>
	</resultMap>

	<resultMap id="columnRComKpiResultMap" type="DwpasRColumnComKpi">
		<result column="COLUMN_CODE" property="columnCode" jdbcType="VARCHAR"
			javaType="string" />
		<result column="COLUMN_ID" property="columnId" jdbcType="VARCHAR"
			javaType="string" />
		<result column="COM_KPI_CODE" property="comKpiCode" jdbcType="VARCHAR"
			javaType="string" />
		<result column="USER_TYPE" property="userType" jdbcType="VARCHAR"
			javaType="string" />
		<result column="VALUE_1" property="value1" jdbcType="VARCHAR"
			javaType="string" />
		<result column="VALUE_2" property="value2" jdbcType="VARCHAR"
			javaType="string" />
		<result column="VALUE_3" property="value3" jdbcType="VARCHAR"
			javaType="string" />
	</resultMap>
	<!-- 栏目及关联的指标信息 -->
	<resultMap id="columnInfoAndKprInfoMap" type="DwpasCColumnInfo">
		<result column="COLUMN_ID" property="columnId" jdbcType="INTEGER"
			javaType="string" />
		<result column="COLUMN_CODE" property="columnCode" jdbcType="VARCHAR"
			javaType="string" />
		<result column="COLUMN_NAME" property="columnName" jdbcType="VARCHAR"
			javaType="string" />
		<result property="columnOrder" column="COLUMN_ORDER" javaType="int"
			jdbcType="INTEGER" />
		<result column="IS_SHOW" property="isShow" jdbcType="INTEGER"
			javaType="int" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR"
			javaType="string" />
		<result column="COLUMN_KIND" property="columnKind" jdbcType="VARCHAR"
			javaType="string" />
		<!-- 图的类型 -->
		<result property="chartType" column="CHART_TYPE" javaType="int"
			jdbcType="INTEGER" />
		<result property="chartTypeDesc" column="CHART_TYPE_DESC"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<!-- 图的URL -->
		<result property="columnUrl" column="CHART_URL" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<!-- 一对多,关联多个指标信息 -->
		<collection property="kpiInfoList" column="KPI_CODE"
			resultMap="com.infosmart.mapper.DwpasCKpiInfoMapper.DwpasCKpiInfoResultMap"
			javaType="java.util.ArrayList" />
	</resultMap>
	<!-- 根据模块ID列出关联的栏目及指标信息 -->
	<select id="listColumnAndKpiCodeByModuleId" parameterType="java.util.HashMap"
		resultMap="columnInfoAndKprInfoMap">
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.KPI_CODE,
		rkc.unit
		FROM
		dwpas_c_column_info
		cci
		LEFT JOIN(
		SELECT
		cck.COLUMN_ID,
		rkc.KPI_CODE,
		cki.unit
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_r_kpi_comkpi rkc
		ON
		cck.com_kpi_code = rkc.com_kpi_code
		LEFT JOIN dwpas_r_prd_kpi rpk ON
		rpk.KPI_CODE = rkc.KPI_CODE
		LEFT JOIN dwpas_c_kpi_info cki ON
		rkc.KPI_CODE = cki.KPI_CODE
		WHERE cki.kpi_type =
		#{kpiType,JDBC=INTEGER} AND rpk.product_id
		=#{productId,JDBC=VARCHAR}
		)rkc ON rkc.COLUMN_ID = cci.COLUMN_ID
		WHERE
		cci.MODULE_ID =
		#{moduleId,JDBC=VARCHAR}
		AND IFNULL(cci.is_overProd, 0)= 0
		UNION
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.KPI_CODE,
		rkc.unit
		FROM
		dwpas_c_column_info
		cci
		LEFT JOIN(
		SELECT
		cck.COLUMN_ID,
		cki.KPI_CODE,
		cki.unit
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_c_kpi_info cki
		ON
		cck.com_kpi_code = cki.KPI_CODE
		WHERE cki.is_overall = 1
		AND
		cki.kpi_type = #{kpiType,JDBC=INTEGER}
		)rkc ON rkc.COLUMN_ID =
		cci.COLUMN_ID
		WHERE
		cci.MODULE_ID = #{moduleId,JDBC=VARCHAR}
		AND
		cci.is_overProd = 1
	</select>
    
    	<!-- 根据modelId获取value2值 -->
	<select id="listRColumnKpiInfoByModuleId" parameterType="java.lang.String" resultMap="columnRComKpiResultMap">
	SELECT
	cck.*
    FROM
	dwpas_r_column_com_kpi cck 
    JOIN dwpas_c_column_info cci ON 
	cci.MODULE_ID = #{moduleId,JDBC=VARCHAR}
    AND cci.COLUMN_ID = cck.COLUMN_ID
    ORDER BY
	cck.order_num
	</select>
	
    
	<!-- xbb添加 -->
	<!-- 自定义图形时，根据模块ID列出关联的栏目及指标信息 ,产品Id是后台配置到value_2里的 -->
	<select id="listColumnInfoListByModuleIdAndKpiType"
		parameterType="java.util.HashMap" resultMap="columnInfoAndKprInfoMap">
		SELECT
		*
		FROM
		(
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.COLUMN_ORDER,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.KPI_CODE,
		rkc.unit,
		rkc.order_num
		FROM
		dwpas_c_column_info cci
		LEFT JOIN(
		SELECT
		cck.COLUMN_ID,
		rkc.KPI_CODE,
		cki.unit,
		cck.order_num
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_r_kpi_comkpi rkc ON cck.com_kpi_code = rkc.com_kpi_code
		LEFT JOIN dwpas_r_prd_kpi rpk ON rpk.KPI_CODE = rkc.KPI_CODE
		LEFT JOIN dwpas_c_kpi_info cki ON rkc.KPI_CODE = cki.KPI_CODE
		WHERE
		cki.kpi_type =#{kpiType,JDBC=INTEGER}
		AND rpk.product_id = cck.VALUE_2
		)rkc ON rkc.COLUMN_ID = cci.COLUMN_ID
		WHERE
		cci.MODULE_ID = #{moduleId,JDBC=VARCHAR}
		AND IFNULL(cci.is_overProd, 0)= 0
		UNION
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.COLUMN_ORDER,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.KPI_CODE,
		rkc.unit,
		rkc.order_num
		FROM
		dwpas_c_column_info cci
		LEFT JOIN(
		SELECT
		cck.COLUMN_ID,
		cki.KPI_CODE,
		cki.unit,
		cck.order_num
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_c_kpi_info cki ON cck.com_kpi_code = cki.KPI_CODE
		WHERE
		cki.is_overall = 1
		AND cki.kpi_type =#{kpiType,JDBC=INTEGER}
		)rkc ON rkc.COLUMN_ID = cci.COLUMN_ID
		WHERE
		cci.MODULE_ID = #{moduleId,JDBC=VARCHAR}
		AND cci.is_overProd = 1
		)a
		ORDER BY
		a.order_num,
		a.COLUMN_ORDER
	</select>
	
	
	<!-- 自定义图形时，根据模块ID以及页面获取的产品Id列出关联的栏目及指标信息 -->
	<select id="listColumnInfoListByModuleIdAndKpiTypeAndProductId" parameterType="java.util.HashMap"
		resultMap="columnInfoAndKprInfoMap">
			SELECT
		*
		FROM
		(
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.COLUMN_ORDER,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.KPI_CODE,
		rkc.unit,
		rkc.order_num
		FROM
		dwpas_c_column_info cci
		LEFT JOIN(
		SELECT
		cck.COLUMN_ID,
		rkc.KPI_CODE,
		cki.unit,
		cck.order_num
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_r_kpi_comkpi rkc ON cck.com_kpi_code = rkc.com_kpi_code
		LEFT JOIN dwpas_r_prd_kpi rpk ON rpk.KPI_CODE = rkc.KPI_CODE
		LEFT JOIN dwpas_c_kpi_info cki ON rkc.KPI_CODE = cki.KPI_CODE
		WHERE
		cki.kpi_type =#{kpiType,JDBC=INTEGER}
		AND rpk.product_id = #{productId,JDBC=VARCHAR}
		)rkc ON rkc.COLUMN_ID = cci.COLUMN_ID
		WHERE
		cci.MODULE_ID = #{moduleId,JDBC=VARCHAR}
		AND IFNULL(cci.is_overProd, 0)= 0
		UNION
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.COLUMN_ORDER,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.KPI_CODE,
		rkc.unit,
		rkc.order_num
		FROM
		dwpas_c_column_info cci
		LEFT JOIN(
		SELECT
		cck.COLUMN_ID,
		cki.KPI_CODE,
		cki.unit,
		cck.order_num
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_c_kpi_info cki ON cck.com_kpi_code = cki.KPI_CODE
		WHERE
		cki.is_overall = 1
		AND cki.kpi_type =#{kpiType,JDBC=INTEGER}
		)rkc ON rkc.COLUMN_ID = cci.COLUMN_ID
		WHERE
		cci.MODULE_ID = #{moduleId,JDBC=VARCHAR}
		AND cci.is_overProd = 1
		)a
		ORDER BY
		a.order_num,
		a.COLUMN_ORDER
	</select>

	<!-- 得到模块信息 -->
	<select id="queryOneModuleInfoByCode" parameterType="java.util.HashMap"
		resultMap="DwpasCModuleInfoMap">
		select cmi.DATE_TYPE,
		cmi.IS_SHOW,
		cmi.MODULE_CODE,
		cmi.MODULE_NAME,
		cmi.REMARK
		from dwpas_c_module_info cmi,
		dwpas_c_system_menu csm
		where cmi.MENU_ID = csm.MENU_ID
		and
		csm.TEMPLATE_ID = #{templateId,JDBC=VARCHAR}
		and cmi.MODULE_CODE =
		#{moduleCode,JDBC=VARCHAR}
	</select>
	<!-- 根据moudleid获得栏目及关联的大盘指标 -->
	<select id="listDwpasCColumnInfoSByMoudleId" parameterType="java.lang.String"
		resultMap="columnInfoAndKprInfoMap">
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		cki.kpi_code,
		cki.parent_code,
		cki.kpi_name,
		cki.disp_name,
		cki.kpi_type,
		cki.is_overall,
		cki.is_show,
		cki.show_order,
		cki.is_average,
		cki.is_max,
		cki.is_variation,
		cki.is_percent,
		cki.unit,
		cki.decimal_num,
		cki.convert_num,
		cki.convert_type,
		cki.is_cal_kpi,
		cki.role_formula,
		cki.is_use
		FROM
		(
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL
		FROM
		dwpas_c_column_info cci
		WHERE
		MODULE_ID = #{moudleId}
		)cci
		LEFT JOIN dwpas_r_column_com_kpi rcck ON
		cci.COLUMN_ID = rcck.COLUMN_ID
		LEFT JOIN dwpas_c_kpi_info cki ON
		cki.kpi_code = rcck.com_kpi_code
	</select>
	<select id="listKpiCodesByColumnId" parameterType="java.util.List"
		resultMap="columnRComKpiResultMap">
		SELECT rck.com_kpi_code,rck.COLUMN_ID FROM dwpas_r_column_com_kpi rck
		WHERE rck.COLUMN_ID IN
		<foreach collection="list" item="columnIdList" open="(" close=")"
			separator=",">
			#{columnIdList}
		</foreach>
	</select>
	<!-- 得到模块信息 -->
	<select id="listModuleInfoByCodes" parameterType="java.util.HashMap"
		resultMap="DwpasCModuleInfoMap">
		select cmi.DATE_TYPE,
		cmi.IS_SHOW,
		cmi.MODULE_CODE,
		cmi.MODULE_NAME,
		cmi.REMARK
		from dwpas_c_module_info cmi, dwpas_c_system_menu csm
		where
		csm.template_id = #{templateId,JDBC=VARCHAR}
		and cmi.MENU_ID =
		csm.MENU_ID
		<if test="moduleCodes">
			and cmi.MODULE_CODE in
			<foreach collection="moduleCodes" close=")" item="moduleCode"
				open="(" separator=",">
				#{moduleCode,JDBC=VARCHAR}
			</foreach>
		</if>
		ORDER BY cmi.MODULE_CODE
	</select>
	<!-- 得到栏目信息 -->
	<select id="queryOneByCode" parameterType="java.util.HashMap"
		resultMap="ColumnAndModuleResultMap">
		select cmi.COLUMN_CODE,
		cmi.COLUMN_ID,
		cmi.COLUMN_KIND,
		cmi.COLUMN_NAME,
		cmi.COUMN_DISPLAY_NAME,
		cmi.MODULE_ID,
		cmm.DATE_TYPE,
		cmm.IS_SHOW,
		cmm.MODULE_NAME,
		cmm.REMARK
		from dwpas_c_column_info cmi,
		dwpas_c_module_info cmm,
		dwpas_c_system_menu cym
		where cmi.MODULE_ID =
		cmm.MODULE_ID
		and cmi.COLUMN_CODE = #{columnCode,JDBC=VARCHAR}
		and
		cmm.MENU_ID = cym.MENU_ID
		and cym.TEMPLATE_ID =
		#{templateId,JDBC=VARCHAR}
	</select>
	<!-- 根据栏目编码和产品ID列出指标信息 -->
	<select id="listKpiCodeByPrdIdAndColumnCode" parameterType="java.util.HashMap"
		resultMap="com.infosmart.mapper.DwpasCKpiInfoMapper.DwpasCKpiInfoResultMap">

		select cki.kpi_code,
		cki.parent_code,
		cki.kpi_name,
		cki.disp_name,
		cki.kpi_type,
		cki.is_overall,
		cki.is_show,
		cki.show_order,
		cki.is_average,
		cki.is_max,
		cki.is_variation,
		cki.is_percent,
		cki.unit,
		cki.decimal_num,
		cki.convert_num,
		cki.convert_type,
		cki.is_cal_kpi,
		cki.role_formula,
		cki.
		is_use
		from DWPAS_R_KPI_COMKPI rkc,
		dwpas_r_prd_kpi rpk, dwpas_c_kpi_info
		cki
		where rpk.KPI_CODE =
		rkc.KPI_CODE
		and rpk.product_id = #{productId}
		and cki.kpi_type =
		#{kpiType}
		and cki.kpi_code = rkc.KPI_CODE
		and exists
		(select
		rcck.com_kpi_code
		from (select ci.COLUMN_CODE, cck.COLUMN_ID,
		cck.com_kpi_code
		from dwpas_r_column_com_kpi cck,
		dwpas_c_column_info
		ci,
		dwpas_c_module_info cmi,
		dwpas_c_system_menu cym
		where cck.COLUMN_ID
		=
		ci.COLUMN_ID
		and ci.MODULE_ID = cmi.MODULE_ID
		and cmi.MENU_ID =
		cym.MENU_ID
		and cym.TEMPLATE_ID = #{templateId,JDBC=VARCHAR}
		and
		ci.COLUMN_CODE
		in
		<foreach collection="codes" item="code" open="(" separator=","
			close=")">
			#{code}
		</foreach>
		)
		rcck
		where rkc.com_kpi_code =
		rcck.com_kpi_code)
		order by
		cki.show_order;

	</select>

	<!-- 根据栏目编码得到关联的通用指标编码 -->
	<select id="queryCommKpiCodeByColumnCode" resultMap="DwpasRColumnComKpiMap"
		parameterType="java.util.HashMap">
		select ci.COLUMN_CODE,
		IFNULL(CI.COUMN_DISPLAY_NAME,ci.COLUMN_NAME) COLUMN_NAME,
		cck.COLUMN_ID,
		cck.com_kpi_code,
		cki.com_kpi_name
		from
		dwpas_r_column_com_kpi cck,
		dwpas_c_column_info ci,
		dwpas_c_module_info cmi,
		dwpas_c_system_menu cym,
		dwpas_c_com_kpi_info cki
		where cck.COLUMN_ID = ci.COLUMN_ID
		and ci.MODULE_ID = cmi.MODULE_ID
		and cmi.MENU_ID = cym.MENU_ID
		AND cck.com_kpi_code = cki.com_kpi_code
		and cym.TEMPLATE_ID = #{templateId,JDBC=VARCHAR}
		and ci.COLUMN_CODE = #{columnCode,JDBC=VARCHAR}
		order by cck.order_num
	</select>
	<!-- 根据多个栏目CODE列出所关联的通用指标CODE -->
	<select id="listCommKpiCodeByColumnCodes" resultMap="DwpasRColumnComKpiMap"
		parameterType="java.util.HashMap">
		select cci.COLUMN_CODE,
		IFNULL(cci.COUMN_DISPLAY_NAME,cci.COLUMN_NAME)
		COLUMN_NAME,
		rcc.com_kpi_code,
		rcc.COLUMN_ID
		from
		dwpas_r_column_com_kpi
		rcc,
		dwpas_c_column_info cci,
		dwpas_c_module_info cmi,
		dwpas_c_system_menu csm
		where rcc.COLUMN_ID =
		cci.COLUMN_ID
		and
		cci.MODULE_ID = cmi.MODULE_ID
		and cmi.MENU_ID =
		csm.MENU_ID
		and
		csm.TEMPLATE_ID = #{templateId,JDBC=VARCHAR}
		<if test="columnCodes!=null">
			and
			cci.COLUMN_CODE in
			<foreach collection="columnCodes" close=")" item="columnCode"
				open="(" separator=",">
				#{columnCode,jdbcType=VARCHAR}
			</foreach>
		</if>
		order by COLUMN_CODE
	</select>
	<!-- 列出某些栏目及其关联的指标信息(产品发展栏目专用) -->
	<select id="queryColumnAndKpiInfoForProductDevelopeColumn"
		parameterType="java.util.HashMap" resultMap="columnInfoAndKprInfoMap">
		SELECT
		CONCAT(COLUMN_CODE,'_',rck.VALUE_1) as COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		rck.VALUE_1 AS columnKind,
		cki.kpi_code,
		parent_code,
		kpi_name,
		disp_name,
		kpi_type,
		is_overall,
		cki.is_show,
		show_order,
		is_average,
		is_max,
		is_variation,
		is_percent,
		unit,
		decimal_num,
		convert_num,
		convert_type,
		is_cal_kpi,
		role_formula,
		is_use
		FROM
		dwpas_c_system_menu
		csm,
		dwpas_c_module_info cmi,
		dwpas_c_column_info cci,
		dwpas_r_column_com_kpi rck,
		dwpas_r_kpi_comkpi rkc,
		dwpas_c_kpi_info
		cki,
		dwpas_r_prd_kpi rpk
		WHERE
		csm.MENU_ID = cmi.MENU_ID
		AND cmi.MODULE_ID
		= cci.MODULE_ID
		AND cci.COLUMN_ID = rck.COLUMN_ID
		AND rck.com_kpi_code =
		rkc.com_kpi_code
		AND rkc.kpi_code = cki.kpi_code
		AND rpk.kpi_code =
		cki.kpi_code
		AND rpk.product_id = #{productId,JDBC=VARCHAR}
		AND
		cki.kpi_type = #{kpiType}
		AND csm.TEMPLATE_ID =
		#{templateId,JDBC=VARCHAR}
		<if test="columnCodes!=null">
			and cci.COLUMN_CODE in
			<foreach collection="columnCodes" close=")" item="columnCode"
				open="(" separator=",">
				#{columnCode,jdbcType=VARCHAR}
			</foreach>
		</if>
		<!-- AND cci.COLUMN_CODE IN( 'PRODUCT_MONTH_TOTAL_TRANSACTIONS_AMOUNT_NEW', 
			'PRODUCT_MONTH_TOTAL_TRANSACTIONS_TIMES_NEW', 'PRODUCT_MONTH_USER_COUNT_NEW', 
			'PRODUCT_MONTH_TOTAL_USER_COUNT_NEW', 'PRODUCT_MONTH_PER_USER_ADMOUNT_NEW', 
			'PRODUCT_MONTH_PER_USER_TIMES_NEW' ) -->
		ORDER BY
		cci.COLUMN_CODE,
		rck.VALUE_1;
	</select>
	<!-- 列出某些栏目及其关联的指标信息 -->
	<select id="queryColumnAndKpiInfoByColumnCodesAndPrdId"
		parameterType="java.util.HashMap" resultMap="columnInfoAndKprInfoMap">
		select cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cki.kpi_code,
		parent_code,
		kpi_name,
		disp_name,
		kpi_type,
		is_overall,
		cki.is_show,
		show_order,
		is_average,
		is_max,
		is_variation,
		is_percent,
		unit,
		decimal_num,
		convert_num,
		convert_type,
		is_cal_kpi,
		role_formula,
		is_use
		from
		dwpas_c_column_info cci,
		dwpas_r_column_com_kpi cck,
		dwpas_r_kpi_comkpi
		rkc,
		dwpas_c_kpi_info cki,
		dwpas_c_module_info cmi,
		dwpas_c_system_menu
		csm,
		dwpas_r_prd_kpi rpk
		where cci.COLUMN_ID = cck.COLUMN_ID
		and
		cck.com_kpi_code = rkc.com_kpi_code
		and rkc.kpi_code = cki.kpi_code
		and
		cmi.MODULE_ID = cci.MODULE_ID
		and cmi.MENU_ID = csm.MENU_ID
		and
		cki.kpi_code = rpk.kpi_code
		and rpk.product_id =
		#{productId,JDBC=VARCHAR}
		and
		csm.TEMPLATE_ID =
		#{templateId,JDBC=VARCHAR}
		and cki.kpi_type =
		#{kpiType}
		<if test="columnCodes!=null">
			and cci.COLUMN_CODE in
			<foreach collection="columnCodes" close=")" item="columnCode"
				open="(" separator=",">
				#{columnCode,jdbcType=VARCHAR}
			</foreach>
		</if>
		order by cki.show_order
	</select>
	<!-- 停用 -->
	<select id="queryCommonCodeByTemplateIdAndUserType"
		parameterType="java.util.HashMap" resultMap="DwpasRColumnComKpiMap">
		select ci.COLUMN_CODE,
		cck.COLUMN_ID, cck.com_kpi_code
		from dwpas_r_column_com_kpi cck,
		dwpas_c_column_info ci,
		dwpas_c_module_info cmi,
		dwpas_c_system_menu cym
		where cck.COLUMN_ID = ci.COLUMN_ID
		and ci.MODULE_ID = cmi.MODULE_ID
		and
		cmi.MENU_ID = cym.MENU_ID
		and cym.TEMPLATE_ID = 1
		and
		cym.menu_id='NH4ha2D6BL0IAOlghCgtAy0jC8OH4cOx'
	</select>

	<!-- 新加的 -->
	<select id="listAllCoumnInfosByModelIdAndKpiType" parameterType="java.util.HashMap"
		resultMap="columnInfoAndKprInfoMap">
		SELECT
		cci.COLUMN_CODE,
		cci.COLUMN_ID,
		cci.COLUMN_KIND,
		cci.COLUMN_NAME,
		cci.COUMN_DISPLAY_NAME,
		cci.MODULE_ID,
		cci.CHART_TYPE,
		cci.CHART_TYPE_DESC,
		cci.CHART_URL,
		rkc.kpi_code,
		rkc.parent_code,
		rkc.kpi_name,
		rkc.disp_name,
		rkc.kpi_type,
		rkc.is_overall,
		rkc.is_show,
		rkc.show_order,
		rkc.is_average,
		rkc.is_max,
		rkc.is_variation,
		rkc.is_percent,
		rkc.unit,
		rkc.decimal_num,
		rkc.convert_num,
		rkc.convert_type,
		rkc.is_cal_kpi,
		rkc.role_formula,
		rkc.is_use
		FROM
		dwpas_c_column_info cci
		LEFT JOIN (
		SELECT
		cck.COLUMN_ID,
		rkc.KPI_CODE,
		cki.parent_code,
		cki.kpi_name,
		cki.disp_name,
		cki.kpi_type,
		cki.is_overall,
		cki.is_show,
		cki.show_order,
		cki.is_average,
		cki.is_max,
		cki.is_variation,
		cki.is_percent,
		cki.unit,
		cki.decimal_num,
		cki.convert_num,
		cki.convert_type,
		cki.is_cal_kpi,
		cki.role_formula,
		cki.is_use
		FROM
		dwpas_r_column_com_kpi cck
		LEFT JOIN dwpas_r_kpi_comkpi
		rkc ON cck.com_kpi_code = rkc.com_kpi_code
		LEFT JOIN dwpas_r_prd_kpi
		rpk ON rpk.KPI_CODE = rkc.KPI_CODE
		LEFT JOIN dwpas_c_kpi_info cki ON
		rkc.KPI_CODE = cki.KPI_CODE
		WHERE cki.kpi_type =#{kpiType}
		AND
		rpk.product_id =cck.VALUE_2
		) rkc ON rkc.COLUMN_ID = cci.COLUMN_ID
		WHERE
		cci.MODULE_ID = #{moduleId}
	</select>
</mapper>