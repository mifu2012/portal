<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.infosmart.mapper.User">
	<resultMap id="UserResultMap" type="User">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Fri Mar 02 09:56:01 
			CST 2012. -->
		<result column="USER_ID" property="userId" jdbcType="INTEGER"
			javaType="int" />
		<result column="LOGINNAME" property="loginName" jdbcType="VARCHAR"
			javaType="string" />
		<result column="PASSWORD" property="passWord" jdbcType="VARCHAR"
			javaType="string" />
		<result column="USERNAME" property="userName" jdbcType="VARCHAR"
			javaType="string" />
		<result column="RIGHTS" property="rights" jdbcType="VARCHAR"
			javaType="string" />
		<result column="STATUS" property="status" jdbcType="INTEGER"
			javaType="int" />
		<result column="ROLE_ID" property="roleId" jdbcType="INTEGER"
			javaType="int" />
		<result column="DWMIS_RIGHTS" property="dwmisRights" jdbcType="VARCHAR"
			javaType="string" />
		<result column="DWPAS_RIGHTS" property="dwpasRights" jdbcType="VARCHAR"
			javaType="string" />
		<result column="REPORT_RIGHTS" property="reportRights"
			jdbcType="VARCHAR" javaType="string" />
		<result column="SELF_RIGHTS" property="selfRights"
			jdbcType="VARCHAR" javaType="string" />
	</resultMap>


	<!-- 用户和权限 hgt -->
	<resultMap type="User" id="userAndRoleResultMap">
		<id column="user_id" property="userId" />
		<result column="loginname" property="loginName" />
		<result column="username" property="userName" />
		<result column="password" property="passWord" />
		<result column="user_rights" property="rights" />
		<result column="status" property="status" />
		<result column="user_dwmis_rights" property="dwmisRights" />
		<result column="user_dwpas_rights" property="dwpasRights" />
		<result column="user_report_rights" property="reportRights" />
		<result column="last_login" property="lastLogin" />
		<association property="role" column="role_id" javaType="Role">
			<id column="role_id" property="roleId" />
			<result column="role_name" property="roleName" />
			<result column="role_rights" property="rights" />
			<result column="role_dwmis_rights" property="dwmisRights" />
		    <result column="role_dwpas_rights" property="dwpasRights" />
		    <result column="role_report_rights" property="reportRights" />
		</association>
	</resultMap>
	<resultMap id="DwpasCTemplateInfoMap" type="DwpasCTemplateInfo">
		<result property="templateId" column="TEMPLATE_ID" javaType="int"
			jdbcType="INTEGER" />
		<result property="templateName" column="TEMPLATE_NAME"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="remark" column="REMARK" javaType="java.lang.String"
			jdbcType="VARCHAR" />
		<result property="gmtCreate" column="GMT_CREATE" javaType="java.util.Date"
			jdbcType="TIMESTAMP" />
	</resultMap>
	<select id="getUser" parameterType="java.util.HashMap"
		resultMap="UserResultMap">

		select
		user_id, loginname, username, rights,
		status, role_id,
		dwmis_rights, dwpas_rights,
		report_rights, last_login
		from tb_user
		where ((loginname
		= #{loginName}) AND (password
		= #{passWord}))
		order by user_id DESC
	</select>
	<select id="getRoleTemplate" resultMap="DwpasCTemplateInfoMap"
		parameterType="int">
		select TEMPLATE_ID,TEMPLATE_NAME,REMARK,GMT_CREATE from
		dwpas_c_template_info where
		template_id in (select template_id from dwpas_template_popedom where
		rid=#{rid,jdbcType=INTEGER})
	</select>
	<!-- 获取用户权限 -->
	<select id="getUserAndRoleById" parameterType="int"
		resultMap="userAndRoleResultMap">
	select u.user_id,u.username,u.rights as
	user_rights,
	u.loginname,
	u.status,
	u.role_id,
	u.dwmis_rights as user_dwmis_rights,
	u.dwpas_rights as user_dwpas_rights,
	u.report_rights as user_report_rights,
	u.last_login,
	r.role_id,
	r.role_name,
	r.rights as role_rights,
	r.dwmis_rights as role_dwmis_rights,
	r.dwpas_rights as role_dwpas_rights,
	r.report_rights as role_report_rights
	from tb_user u
	left join tb_role r on u.role_id=r.role_id
	where u.status=0 and u.user_id=#{userId}
	</select>
	
	<!-- 获取自服务权限 -->
	<select id="getSelfRights" parameterType="int" resultType="String">
		select self_rights from tb_user where user_id=#{userId}
	</select>
	
	<update id="updatePassWord" parameterType="java.util.HashMap">
	update tb_user set password=#{passWord} where user_id=#{userId}
	</update>
	
	<select id="getAllReceiveUsersBySendUser" parameterType="int" resultMap="UserResultMap">
		select
		user_id,loginname,username from tb_user where user_id!=#{userId}
	</select>
	
	<select id="getTemplateInfos" resultMap="DwpasCTemplateInfoMap">
	select * from dwpas_c_template_info WHERE 
	TEMPLATE_ID
		in
	<foreach collection="list" item="templateIdList" open="(" separator=","
			close=")">
			#{templateIdList}
    </foreach>
    ORDER BY TEMPLATE_ID
	</select>
</mapper>